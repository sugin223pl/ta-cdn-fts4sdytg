($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/trips.trip-util",d:["vendor-babel","ta-platform","lithium-platform","@ta/trips.trip-types","@ta/trips.graphql"],e:["./packages/trips/trip-util/trip-util.jsx"],x:{"./packages/trips/trip-util/trip-util.jsx":["getTripCoverPhoto","getTripUsers","isTripUser","userTypeFromTrip","getTripPermissions","getCollabPermissions","getItemPermissions","getCommentPermissions","getTripUsersForDisplay","getCommentsForDisplay","isOwner","getItemByReference","getItemIdByReference","saveObjectExistsInTrip","itemExistsInTrip","updateSocialStatisticsOnSave","updateSocialStatisticsOnUnsave","getReferenceTypeFromObjectType","getQueryReferenceTypeFromObjectType","toSavesObject","toReference","buildPublicTripShareUrl","objectStatisticQuery","isRepostSaveable","windowOpener"]},m:{"./packages/trips/trip-util/trip-util.jsx":function(e,t,i){"use strict";i.r(t);var n=i("@babel/runtime/helpers/esm/defineProperty"),r=i.n(n),a=i("@babel/runtime/helpers/esm/objectSpread"),o=i.n(a),s=i("@ta/common.global"),c=i("@ta/common.features"),d=(i("@ta/trips.trip-types"),i("@ta/trips.graphql")),l={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"SocialStatisticsFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SocialStatistics"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"followCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isFollowing"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isLiked"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isBoosted"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"boostCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"likeCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isReposted"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"repostCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"isSaved"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tripCount"},arguments:[],directives:[]}]}}],loc:{start:0,end:180}};l.loc.source={body:"327d74d0be74"};var u=l,m={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FeedObjectStatisticFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FeedObject"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Video"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"socialStatistics"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"SocialStatisticsFields"},directives:[]}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Photo"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"socialStatistics"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"SocialStatisticsFields"},directives:[]}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ForumPost"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"socialStatistics"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"SocialStatisticsFields"},directives:[]}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"LinkPost"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"socialStatistics"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"SocialStatisticsFields"},directives:[]}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Review"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"socialStatistics"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"SocialStatisticsFields"},directives:[]}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Trip"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"socialStatistics"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"SocialStatisticsFields"},directives:[]}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Repost"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"socialStatistics"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"SocialStatisticsFields"},directives:[]}]}}]}}]}}],loc:{start:0,end:684}};m.loc.source={body:"090f84a668e0"};var p={};m.definitions=m.definitions.concat(function f(e){return e.filter(function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!p[t]&&(p[t]=!0,!0)})}(u.definitions));var v=m;i.d(t,"getTripCoverPhoto",function(){return S}),i.d(t,"getTripUsers",function(){return k}),i.d(t,"isTripUser",function(){return g}),i.d(t,"userTypeFromTrip",function(){return y}),i.d(t,"getTripPermissions",function(){return b}),i.d(t,"getCollabPermissions",function(){return F}),i.d(t,"getItemPermissions",function(){return T}),i.d(t,"getCommentPermissions",function(){return N}),i.d(t,"getTripUsersForDisplay",function(){return O}),i.d(t,"getCommentsForDisplay",function(){return I}),i.d(t,"isOwner",function(){return P}),i.d(t,"getItemByReference",function(){return j}),i.d(t,"getItemIdByReference",function(){return C}),i.d(t,"saveObjectExistsInTrip",function(){return R}),i.d(t,"itemExistsInTrip",function(){return w}),i.d(t,"updateSocialStatisticsOnSave",function(){return L}),i.d(t,"updateSocialStatisticsOnUnsave",function(){return U}),i.d(t,"getReferenceTypeFromObjectType",function(){return V}),i.d(t,"getQueryReferenceTypeFromObjectType",function(){return Q}),i.d(t,"toSavesObject",function(){return M}),i.d(t,"toReference",function(){return W}),i.d(t,"buildPublicTripShareUrl",function(){return q}),i.d(t,"objectStatisticQuery",function(){return $}),i.d(t,"isRepostSaveable",function(){return H}),i.d(t,"windowOpener",function(){return K});var S=function e(t){return t.photo&&t.photo.photoSizes[t.photo.photoSizes.length-1]?t.photo.photoSizes[t.photo.photoSizes.length-1]:null},k=function e(t){var i=t.owner||t.userProfile,n=i?[i]:[];if(Object(c.featureIsEnabled)("trips_2018_collab")){var r=(t.collaborators||[]).map(function(e){return e.user}).filter(Boolean);n=n.concat(r)||[]}return n},g=function e(t,i){return k(t).some(function(e){return e.isMe||e.userId&&e.userId===i||e.id&&e.id===i})},y=function e(t){var i;return(null===(i=t.owner)||void 0===i?void 0:i.isMe)?"OWNER":t&&g(t)?"COLLABORATOR":"PUBLIC"},b=function e(t,i){return Object(c.featureIsEnabled)("trips_2018_collab")?t.actionPermissions:{canAddCollaborators:i,canAddItem:i,canChangePrivacy:i,canDelete:i,canEdit:i,canUploadCoverPhoto:t.actionPermissions&&t.actionPermissions.canUploadCoverPhoto&&i}},F=function e(t,i){return Object(c.featureIsEnabled)("trips_2018_collab")?t.actionPermissions:{canRemove:i}},T=function e(t,i){return Object(c.featureIsEnabled)("trips_2018_collab")?t.actionPermissions:{canAddComment:i,canEdit:i,canRemove:i}},N=function e(t,i){return Object(c.featureIsEnabled)("trips_2018_collab")?t.actionPermissions:{canEdit:i,canRemove:i}},O=function e(t,i,n,r){var a=k(t);if(a=a.slice(0,i),n>0){var o=0;a=a.filter(function(e){return(o=e.displayName.length+o)<n})}return r&&(a=a.reverse()),a},I=function e(t,i,n){var r=n&&n.id,a=Object(c.featureIsEnabled)("trips_2018_collab")?function(){return!0}:function(e){return e.author.id===r||"ITEM"===e.targetType&&e.targetId!==t.id};return(i||[]).filter(a).sort(function e(t,i){return t.created>i.created?1:-1})},P=function e(t){var i;return null==t?void 0:null===(i=t.owner)||void 0===i?void 0:i.isMe},j=function e(t,i){return(t.items||[]).find(function(e){var t,n=e.reference&&e.reference.type&&e.reference.type.toLowerCase(),r=null===(t=e.reference)||void 0===t?void 0:t.id,a=i.type.toLowerCase(),o=i.id.toString(),s=i.originalObject&&i.originalObject.type&&i.originalObject.type.toLowerCase(),c=i.originalObject&&i.originalObject.id.toString();return n===a&&r===o||n===s&&r===c})},C=function e(t,i){var n=j(t,i);return n?n.id:null},h=function e(t,i){return"savesItem"===i.type?t.id===i.id:"location"===i.type?!!t.object&&t.object.locationId&&t.object.locationId.toString()===i.id.toString():"attractionProduct"===i.type?!!t.object&&t.object.attractionProductId&&t.object.attractionProductId.toString()===i.id.toString():!!t.reference&&t.reference.type===i.type&&t.reference.id===i.id.toString()},R=function e(t,i){return!!(t.items||[]).find(function(e){return h(e,i)||!!i.originalObject&&h(e,i.originalObject)})},w=function e(t,i){return!!(t.items||[]).find(function(e){return!(!e.reference||!i.reference)&&e.reference.id===i.reference.id&&e.reference.type===i.reference.type})},_={savesItem:{fragment:d.TripItemStatisticFields,fragmentName:"TripItemStatisticFields",dataTypename:"TripItem"},link:{fragment:v,fragmentName:"FeedObjectStatisticFields",dataTypename:"LinkPost"},photo:{fragment:v,fragmentName:"FeedObjectStatisticFields",dataTypename:"Photo"},video:{fragment:v,fragmentName:"FeedObjectStatisticFields",dataTypename:"Video"},review:{fragment:v,fragmentName:"FeedObjectStatisticFields",dataTypename:"Review"},repost:{fragment:v,fragmentName:"FeedObjectStatisticFields",dataTypename:"Repost"}},E=function e(t,i,n,a){var c=_[i.type];if(c){var d,l=c.fragment,u=c.fragmentName,m=c.dataTypename,p="".concat(m,":").concat(i.id),f=t.readFragment({id:p,fragment:l,fragmentName:u}),v=Object(s.getObjectIdField)(m),S=((null==f?void 0:f.socialStatistics)||{}).tripCount,k=a(void 0===S?n:S);t.writeFragment({id:p,fragment:l,fragmentName:u,data:(d={__typename:m},r()(d,v,i.id),r()(d,"socialStatistics",o()({},f.socialStatistics,{isSaved:k>0,tripCount:k,__typename:"SocialStatistics"})),d)})}},L=function e(t,i){return E(t,i,0,function(e){return e+1})},U=function e(t,i){return E(t,i,1,function(e){return e-1})},D={locationinformation:"location",attractionproductinformation:"attractionProduct",forumpost:"post",tripitem:"savesItem",linkpost:"link",photo:"photo",video:"video",review:"review",repost:"repost",trip:"bundleSave"},A={locationinformation:"LOCATION",attractionproductinformation:"ATTRACTIONPRODUCT",forumpost:"POST",tripitem:"SAVESITEM",linkpost:"LINK",photo:"PHOTO",video:"VIDEO",review:"REVIEW",repost:"REPOST",trip:"TRIPCONTENT"},x=function e(t){return{statQuery:t}},B=Object.freeze({location:x(d.LocationStatistics),attractionProduct:x(d.AttractionStatistics),post:x(d.ForumStatistics),savesItem:x(d.TripItemStatistics),link:x(d.LinkPostStatistics),review:x(d.ReviewStatistics),photo:x(d.PhotoStatistics),video:x(d.VideoStatistics),repost:x(d.RepostStatistics)}),V=function e(t){return D[t.toLowerCase()]},Q=function e(t){return A[t.toLowerCase()]},z=["LocationInformation","AttractionProductInformation","ForumPost","LinkPost","Review","Photo","Video","Repost","Trip"],M=function e(t){if(!t)return null;var i=Object(s.getObjectId)(t),n=V(t.__typename);if(i&&n){if(z.includes(t.__typename))return{type:n,id:i};if("TripItem"===t.__typename&&t.reference&&t.reference.id&&t.reference.type)return{type:n,id:i,originalObject:{id:t.reference.id,type:"attractionproduct"===t.reference.type?"attractionProduct":t.reference.type}}}return null},W=function e(t){return{id:"".concat(t.id),type:t.type}},q=function e(t,i){var n=i?"?itemId=".concat(i):"";return"/Trips/".concat(t).concat(n)},$=function e(t){var i=B[t.type];return i?t&&{query:i.statQuery,variables:{ids:[t.id]}}:null},H=function e(t){var i,n;return["LinkPost","Photo","Review","Video"].includes(null==t?void 0:null===(i=t.object)||void 0===i?void 0:null===(n=i.repostedObject)||void 0===n?void 0:n.__typename)},K=function e(t,i){var n=window.open("about:blank",i);return function(){n.location=t}}}}});
//# sourceMappingURL=trips.trip-util.bce96502fd.js.map