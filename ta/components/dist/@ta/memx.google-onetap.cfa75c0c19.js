($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/memx.google-onetap",d:["vendor-babel","vendor-react-libs","vendor-redux-libs","@ta/social.onboarding-state","lithium-platform","ta-platform","@ta/memx.registration-dialog-utils","vendor-urql","ta-common"],e:["./packages/memx/google-onetap/GoogleOneTapLoader.jsx"],x:{"./packages/memx/google-onetap/GoogleOneTapLoader.jsx":["GOOGLE_PID","GOOGLE_FLOW","LOADER_TRACKING_MODULE","default"]},m:{"./packages/memx/google-onetap/GoogleOneTapLoader.jsx":function(e,a,t){"use strict";t.r(a);var o=t("@babel/runtime/helpers/esm/classCallCheck"),n=t.n(o),l=t("@babel/runtime/helpers/esm/createClass"),s=t.n(l),i=t("@babel/runtime/helpers/esm/possibleConstructorReturn"),r=t.n(i),_=t("@babel/runtime/helpers/esm/getPrototypeOf"),c=t.n(_),d=t("@babel/runtime/helpers/esm/inherits"),u=t.n(d),g=t("@babel/runtime/helpers/esm/assertThisInitialized"),m=t.n(g),b=t("@babel/runtime/helpers/esm/defineProperty"),p=t.n(b),O=t("react"),h=t("react-redux"),v=t("@ta/social.onboarding-state"),T=t("@ta/common.features"),f=t("@ta/common.tracking"),k=t.n(f),E=t("@ta/memx.registration-dialog-utils"),j=t("urql"),S={yoloIframeBase:"memx-google-onetap-GoogleOneTapLoader__yoloIframeBase--XtJgm",yoloIframeContextualMessageAdjacentDW:"memx-google-onetap-GoogleOneTapLoader__yoloIframeContextualMessageAdjacentDW--2KfUM"},y=t("@ta/common.classnames"),G=t.n(y),x=t("@ta/styleguide.icon"),I=t("@ta/common.i18n"),z=["Home","Tourism","MobileTourism","ShowTopic","MobileShowTopic"];function R(){return Object(T.featureIsEnabled)("google_onetap_contextual_message_desktop")||Object(T.featureIsEnabled)("google_onetap_contextual_message_mobile")}var C={headline:Object(I.localize)("onetap_message_unlock"),subhead:Object(I.localize)("onetap_message_subhead_to_get_the_most")},L={servlet_mapping:[],fallback:{desktop:C,tablet:C,mobile:C}},M=Object(h.connect)(function(e,a){return{servlet:e.meta.initialServletName,bottomPosition:a.bottomPosition,viewportCategory:e.meta.device.viewportCategory}})(function e(a){if(function t(e){return Object(T.featureIsEnabled)("t10564_got_contextual_v2_variant_1")?"Home"===e||E.HOTEL_SERVLETS.includes(e)&&Object(T.featureIsEnabled)("google_onetap_contextual_message_mobile"):!!Object(T.featureIsEnabled)("t10565_got_contextual_v2_variant_2")&&E.FLIGHTS_SERVLETS.includes(e)&&Object(T.featureIsEnabled)("google_onetap_contextual_message_mobile")}(a.servlet))return null;var o=a.viewportCategory.toLowerCase(),n=function l(e,a,t){var o=function n(e){return Object(T.featureIsEnabled)("t10564_got_contextual_v2_variant_1")?{servlet_mapping:[{servlets:E.HOTEL_SERVLETS,messages:{desktop:{headline:Object(I.localize)("onetap_message_saving_saves_hotels"),subhead:Object(I.localize)("onetap_message_subhead_to_get_the_most")},tablet:{headline:Object(I.localize)("onetap_message_saving_money"),subhead:Object(I.localize)("onetap_subhead_signin_alerts_deals")}}},{servlets:E.FLIGHTS_SERVLETS,messages:{desktop:{headline:Object(I.localize)("onetap_message_unlock"),subhead:Object(I.localize)("key_1_GOT2_FlightsSub2")},tablet:{headline:Object(I.localize)("onetap_message_unlock"),subhead:Object(I.localize)("key_1_GOT2_FlightsSub2")},mobile:{headline:Object(I.localize)("onetap_message_fomo_flightalerts")}}},{servlets:E.ATTRACTIONS_SERVLETS,messages:{desktop:{headline:Object(I.localize)("onetap_message_unlock"),subhead:Object(I.localize)("key_2_GOT2_ExpSub2")},tablet:{headline:Object(I.localize)("onetap_message_unlock"),subhead:Object(I.localize)("key_2_GOT2_ExpSub2")},mobile:{headline:Object(I.localize)("onetap_message_saving_saves_thingstodo")}}},{servlets:E.RESTAURANTS_SERVLETS,messages:e?{desktop:{headline:Object(I.localize)("onetap_message_unlock"),subhead:Object(I.localize)("sign_in_geo_v3",{geo_name:e})},tablet:{headline:Object(I.localize)("key_5_GOT2_Reshead1",{geo_name:e}),subhead:Object(I.localize)("onetap_subhead_start_saving")},mobile:{headline:Object(I.localize)("key_6_GOT2_Reshead2",{geo_name:e})}}:L.fallback},{servlets:E.FORUM_SERVLETS,messages:{desktop:{headline:Object(I.localize)("key_7_id_GOT2_ForumHead1"),subhead:Object(I.localize)("key_8_id_GOT2_ForumSub1")},tablet:{headline:Object(I.localize)("key_7_id_GOT2_ForumHead1"),subhead:Object(I.localize)("key_8_id_GOT2_ForumSub1")}}}],fallback:L.fallback}:Object(T.featureIsEnabled)("t10565_got_contextual_v2_variant_2")?{servlet_mapping:[{servlets:E.HOTEL_SERVLETS,messages:{tablet:{headline:Object(I.localize)("onetap_message_genius_saves_travelideas"),subhead:Object(I.localize)("onetap_subhead_start_saving")}}},{servlets:E.ATTRACTIONS_SERVLETS,messages:{desktop:{headline:Object(I.localize)("onetap_message_unlock"),subhead:Object(I.localize)("key_3_GOT2_ExpSub3")},tablet:{headline:Object(I.localize)("onetap_message_unlock"),subhead:Object(I.localize)("key_3_GOT2_ExpSub3")}}},{servlets:E.RESTAURANTS_SERVLETS,messages:{tablet:{headline:Object(I.localize)("onetap_message_genius_saves_ideas"),subhead:Object(I.localize)("onetap_subhead_start_saving")},mobile:{headline:Object(I.localize)("onetap_message_saving_saves_restaurants")}}},{servlets:E.FORUM_SERVLETS,messages:{desktop:{headline:Object(I.localize)("key_9_id_GOT2_ForumHead1"),subhead:Object(I.localize)("key_8_id_GOT2_ForumSub1")},tablet:{headline:Object(I.localize)("key_9_id_GOT2_ForumHead1"),subhead:Object(I.localize)("key_8_id_GOT2_ForumSub1")},mobile:{headline:Object(I.localize)("key_9_id_GOT2_ForumHead1")}}}],fallback:L.fallback}:Object(T.featureIsEnabled)("t10566_got_contextual_v2_variant_3")?{servlet_mapping:[{servlets:E.FORUM_SERVLETS,messages:{desktop:{headline:Object(I.localize)("key_10_id_GOT2_ForumHead2"),subhead:Object(I.localize)("key_8_id_GOT2_ForumSub1")},tablet:{headline:Object(I.localize)("key_10_id_GOT2_ForumHead2"),subhead:Object(I.localize)("key_8_id_GOT2_ForumSub1")},mobile:{headline:Object(I.localize)("key_10_id_GOT2_ForumHead2")}}}],fallback:L.fallback}:Object(T.featureIsEnabled)("t10567_got_contextual_v2_variant_4")?{servlet_mapping:[{servlets:E.FORUM_SERVLETS,messages:{desktop:{headline:Object(I.localize)("key_11_id_GOT2_ForumHead3"),subhead:Object(I.localize)("key_8_id_GOT2_ForumSub1")},tablet:{headline:Object(I.localize)("key_11_id_GOT2_ForumHead3"),subhead:Object(I.localize)("key_8_id_GOT2_ForumSub1")},mobile:{headline:Object(I.localize)("key_11_id_GOT2_ForumHead3")}}}],fallback:L.fallback}:Object(T.featureIsEnabled)("t10568_got_contextual_v2_variant_5")?{servlet_mapping:[{servlets:E.FORUM_SERVLETS,messages:{desktop:{headline:Object(I.localize)("key_12_id_GOT2_ForumHead4"),subhead:Object(I.localize)("key_8_id_GOT2_ForumSub1")},tablet:{headline:Object(I.localize)("key_12_id_GOT2_ForumHead4"),subhead:Object(I.localize)("key_8_id_GOT2_ForumSub1")},mobile:{headline:Object(I.localize)("key_12_id_GOT2_ForumHead4")}}}],fallback:L.fallback}:L}(a),l=o.servlet_mapping.find(function(a){return a.servlets.includes(e)});return l&&l.messages[t]||o.fallback[t]}(a.servlet,a.geoName,o),s=a.bottomPosition||0;return Object(T.featureIsEnabled)("google_onetap_contextual_message_mobile")&&s?O.createElement("div",{className:G()("memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageContainer--2MPRe","memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageMobileDevice--3b5il"),style:{bottom:"".concat(s,"px")}},O.createElement("div",{className:"memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageInnerContainer--1GpCH"},O.createElement("h3",{className:"memx-google-onetap-GoogleOneTapContextualMessage__headline--19hK6"},O.createElement(x.Icon,{name:"lock-fill",className:"memx-google-onetap-GoogleOneTapContextualMessage__oneTapIcon--1Nsdz"}),n.headline))):O.createElement("div",{className:G()("memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageContainer--2MPRe","memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageDesktopTablet--zsYLB")},O.createElement("div",{className:"memx-google-onetap-GoogleOneTapContextualMessage__oneTapMessageInnerContainer--1GpCH"},O.createElement("h3",{className:"memx-google-onetap-GoogleOneTapContextualMessage__headline--19hK6"},O.createElement(x.Icon,{name:"lock-fill",className:"memx-google-onetap-GoogleOneTapContextualMessage__oneTapIcon--1Nsdz"}),n.headline),O.createElement("p",{className:"memx-google-onetap-GoogleOneTapContextualMessage__subhead--YO-_R"},n.subhead)))}),N={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"LocationName"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"locationIds"},value:{kind:"ListValue",values:[{kind:"Variable",name:{kind:"Name",value:"locationId"}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:97}};N.loc.source={body:"79fb1ad0fd40"};var F=N;t.d(a,"GOOGLE_PID",function(){return A}),t.d(a,"GOOGLE_FLOW",function(){return H}),t.d(a,"LOADER_TRACKING_MODULE",function(){return w});var A=40185,H="GOOGLE_ONETAP",w="google_onetap",P=0,V=function(e){function a(e){var t;return n()(this,a),t=r()(this,c()(a).call(this,e)),p()(m()(m()(t)),"onGoogleYoloLoad",function(){return(t.props.adhesionRendered||R())&&t.props.googleApi.addClassName(S.yoloIframeBase).addClassName(S.yoloIframeContextualMessageAdjacentDW,function(){return Object(T.featureIsEnabled)("google_onetap_contextual_message_desktop")&&t.state.isMessageEligible}).captureIframeEvents(t.onOneTapHeightChange),t.props.adhesionRendered&&t.trackAction("google_onetap_adhesion_detected"),Object(T.featureIsEnabled)("google_onetap_web_component_autologin")&&!Object(E.userSignedOut)()?t.retrieve():t.hint()}),p()(m()(m()(t)),"onOneTapHeightChange",function(e){t.setState({googleOneTapHeight:e}),e>0&&t.props.adhesionRendered&&(t.moveGoogleOneTapIframeForAdhesion(),Object(E.moveAdCloseX)(!1),t.trackAction("google_onetap_modal_moved_above_adhesion"))}),p()(m()(m()(t)),"handleOneTapException",function(){t.resetState(),t.props.triggerNext()}),p()(m()(m()(t)),"handleOneTapSuccess",function(e){t.resetState(),e.idToken&&(Object(E.moveAdCloseX)(!0),t.showRegOverlay(e))}),p()(m()(m()(t)),"handleAutoLoginError",function(e){Object(E.moveAdCloseX)(!0),t.resetState(),"noCredentialsAvailable"!==e.type?"userCanceled"===e.type?t.props.onDismiss():t.props.triggerNext():t.hint()}),p()(m()(m()(t)),"handleOneTapError",function(e){Object(E.moveAdCloseX)(!0),t.resetState(),"userCanceled"===e.type?t.props.onDismiss():t.props.triggerNext()}),t.state={isMessageEligible:!1,googleOneTapHeight:P},t}return u()(a,e),s()(a,[{key:"componentDidMount",value:function e(){if(function a(e,t){return!!function o(e){return!Object(T.featureIsEnabled)("google_onetap_web_component_hotel_servlets")&&E.HOTEL_SERVLETS.includes(e)}(t)||!!function n(){return!Object(T.featureIsEnabled)("google_onetap_web_component_mobile_adhesion")&&Object(T.featureIsEnabled)("mobile_fixed_ad")}()||!Object(T.featureIsEnabled)("google_onetap_web_component_mobile")&&!Object(T.featureIsEnabled)("google_onetap_web_component_desktop")}(this.props.viewportCategory,this.props.servlet))this.props.triggerNext();else if(this.trackAction("google_onetap_requested"),z.includes(this.props.servlet)||Object(T.featureIsEnabled)("google_onetap_web_component")){var t=Object(T.featureIsEnabled)("mobile_web")?null:"navPopout";this.props.googleApi.load(t,null).then(this.onGoogleYoloLoad)}}},{key:"componentDidUpdate",value:function e(a){a.adhesionRendered&&!this.props.adhesionRendered&&this.moveGoogleOneTapIframeForAdhesion()}},{key:"moveGoogleOneTapIframeForAdhesion",value:function e(){var a=document.getElementsByClassName(S.yoloIframeBase);if(a&&0!==a.length){var t=this.props.adhesionRendered?50:0;a[0].style.bottom="".concat(t,"px")}}},{key:"calculateMessageBottomPosition",value:function e(){return(this.props.adhesionRendered?50:0)+this.state.googleOneTapHeight-39}},{key:"resetState",value:function e(){(this.state.isMessageEligible||this.state.googleOneTapHeight!==P)&&this.setState({isMessageEligible:!1,googleOneTapHeight:P})}},{key:"retrieve",value:function e(){return this.props.googleApi.retrieve().then(this.handleOneTapSuccess,this.handleAutoLoginError).catch(this.handleOneTapException)}},{key:"hint",value:function e(){return this.setState({isMessageEligible:!0}),this.props.googleApi.hint().then(this.handleOneTapSuccess,this.handleOneTapError).catch(this.handleOneTapException)}},{key:"showRegOverlay",value:function e(a){var t=this;window.require(["ta/registration/RegOverlay"],function(e){var o="MOBILE"===t.props.viewportCategory;e.showRegOverlay(null,null,o,{flow:H,pid:A,userRequestedForce:"true",extraQueryParams:{google_id_token:a.idToken},displayOnShowOverlay:!0,onSuccess:function e(a){a&&a.user_id&&("Home"===t.props.servlet||Object(T.featureIsEnabled)("onetap_onboarding")?t.props.setShouldFire(!1,"GOOGLE_ONETAP"):Object(T.featureIsEnabled)("app_dl_for_got_and_fbot")&&t.props.setShouldFire(!1,"GOOGLE_ONETAP_NON_HOME"))}})})}},{key:"trackAction",value:function e(a){k()({module:w,action:a,context:"".concat(a.replace(/^google_onetap_/,""),"_").concat(this.props.servlet||"unknown","_").concat(H),value:A})}},{key:"render",value:function e(){var a=this;return!this.state.isMessageEligible||!R()||this.state.googleOneTapHeight<=0?null:this.props.locationId&&E.RESTAURANTS_SERVLETS.includes(this.props.servlet)&&Object(T.featureIsEnabled)("t10564_got_contextual_v2_variant_1")?O.createElement(j.Query,{query:F,variables:{locationId:this.props.locationId}},function(e){var t,o=e.fetching,n=e.data;return o?null:O.createElement(M,{bottomPosition:a.calculateMessageBottomPosition(),geoName:null==n?void 0:null===(t=n.locations)||void 0===t?void 0:t[0].name})}):O.createElement(M,{bottomPosition:this.calculateMessageBottomPosition()})}}]),a}(O.Component);a.default=Object(h.connect)(function(e){return{isMember:e.auth.isMember,servlet:e.meta.initialServletName,viewportCategory:e.meta.device.viewportCategory,locationId:e.route.geo}},{setShouldFire:v.ACTIONS.setShouldFire})(V)}}});
//# sourceMappingURL=memx.google-onetap.cfa75c0c19.js.map