($WP="undefined"!=typeof $WP?$WP:[]).push({id:"@ta/memx.facebook-onetap",d:["vendor-babel","vendor-react-libs","vendor-redux-libs","vendor-common","lithium-platform","ta-platform","@ta/memx.registration-dialog-utils","@ta/overlays.pieces","@ta/social.onboarding-state"],e:["./packages/memx/facebook-onetap/FacebookOneTapLoader.jsx"],x:{"./packages/memx/facebook-onetap/FacebookOneTapLoader.jsx":["default"]},m:{"./packages/memx/facebook-onetap/FacebookOneTapLoader.jsx":function(e,o,a){"use strict";a.r(o);var t=a("@babel/runtime/helpers/esm/classCallCheck"),n=a.n(t),s=a("@babel/runtime/helpers/esm/createClass"),i=a.n(s),r=a("@babel/runtime/helpers/esm/possibleConstructorReturn"),c=a.n(r),l=a("@babel/runtime/helpers/esm/getPrototypeOf"),d=a.n(l),b=a("@babel/runtime/helpers/esm/inherits"),p=a.n(b),u=a("@babel/runtime/helpers/esm/assertThisInitialized"),m=a.n(u),f=a("@babel/runtime/helpers/esm/defineProperty"),k=a.n(f),_=a("react"),h=a("react-redux"),g=a("js-cookie"),O=a.n(g),v=a("@ta/common.classnames"),F=a.n(v),T=a("@ta/common.features"),w=a("@ta/common.i18n"),E=a("@ta/common.logging"),I=a.n(E),x=a("@ta/common.radio"),A=a.n(x),L=a("@ta/common.tracking"),C=a.n(L),S=a("@ta/memx.registration-dialog-utils"),y=a("@ta/overlays.pieces"),j=a("@ta/social.onboarding-state"),N=function(e){function o(e){var a;return n()(this,o),a=c()(this,d()(o).call(this,e)),k()(m()(m()(a)),"onFacebookLoadSdkAndInit",function(){window.require(["facebook/authutils"],function(e){e.loadSdkAndInit(a.props.fbSdkUrl,a.props.fbConnectAppId,a.props.fbApiVersion),e.queueForInit(a.onFacebookInit)})}),k()(m()(m()(a)),"onFacebookInit",function(){a.setState({fbSdkInitialized:!0}),window.FB.Event.subscribe("xfbml.render",function(){a.trackAction("facebook_onetap_rendered")}),window.FB.getLoginStatus(function(e){"connected"===e.status||"not_authorized"===e.status?a.setState({fbUserLoggedIn:!0}):(a.setState({disabled:!0}),a.props.triggerNext())})}),k()(m()(m()(a)),"onFacebookLogin",function(){a.trackAction("facebook_onetap_clicked"),window.FB.getLoginStatus(function(e){if("connected"===e.status){var o=e.authResponse;o&&o.accessToken?a.onFacebookAccountConnected(o.signedRequest):I.a.warn("Error in reading login request from Facebook")}})}),k()(m()(m()(a)),"onFacebookAccountConnected",function(e){var o=a.parseFBSignedRequest(e);o&&o.code?(O.a.set("FacebookAuthCode2",o.code,{expires:new Date((new Date).getTime()+5e3),domain:a.props.cookieDomain,path:"/"}),window.require(["ta/registration/RegOverlay"],function(e){var o="MOBILE"===a.props.viewportCategory;e.showRegOverlay(null,null,o,{flow:"FACEBOOK_ONETAP",pid:40600,userRequestedForce:"true",extraQueryParams:{social:"true"},displayOnShowOverlay:!0,onClose:function e(){a.dismissFbOneTap()},onSuccess:function e(o){o&&o.user_id&&(a.disableFbOneTap(),"Home"===a.props.servlet||Object(T.featureIsEnabled)("onetap_onboarding")?a.props.setShouldFire(!1,"FACEBOOK_ONETAP"):Object(T.featureIsEnabled)("app_dl_for_got_and_fbot")&&a.props.setShouldFire(!1,"FACEBOOK_ONETAP_NON_HOME"))}})})):I.a.warn("Error in parsing signed request from Facebook")}),k()(m()(m()(a)),"parseFBSignedRequest",function(e){if(!e)return null;var o=e.split(".",2)[1];if(o){var t=atob(o);try{return JSON.parse(t)}catch(e){a.trackAction("facebook_onetap_parseSignedRequestFailed")}}return null}),k()(m()(m()(a)),"dismissFbOneTap",function(){a.disableFbOneTap(),a.trackAction("facebook_onetap_closed"),a.props.onDismiss()}),k()(m()(m()(a)),"disableFbOneTap",function(){a.state.disabled||(a.setState({disabled:!0}),Object(S.moveAdCloseX)(!0))}),a.state={fbSdkInitialized:!1,fbUserLoggedIn:!1,disabled:a.isFacebookOneTapDisabled()},a}return p()(o,e),i()(o,[{key:"componentWillMount",value:function e(){this.state.disabled&&this.props.triggerNext()}},{key:"componentDidMount",value:function e(){this.state.disabled?this.props.triggerNext():(this.trackAction("facebook_onetap_requested"),Object(T.featureIsEnabled)("hr_defer_facebook_sdk")?A()("TimeToInteractive").on("TimeToInteractive",this.onFacebookLoadSdkAndInit):this.onFacebookLoadSdkAndInit())}},{key:"isFacebookOneTapDisabled",value:function e(){return!(Object(T.featureIsEnabled)("facebook_onetap_hotel_servlets")||!S.HOTEL_SERVLETS.includes(this.props.servlet))||!(Object(T.featureIsEnabled)("facebook_onetap_mobile_adhesion")||!Object(T.featureIsEnabled)("mobile_fixed_ad"))||!Object(T.featureIsEnabled)("facebook_onetap_mobile")&&!Object(T.featureIsEnabled)("facebook_onetap_desktop")}},{key:"trackAction",value:function e(o){C()({module:"facebook_onetap",action:o,context:"".concat(this.props.servlet||"unknown")})}},{key:"render",value:function e(){if(this.state.disabled||!this.state.fbSdkInitialized||!this.state.fbUserLoggedIn)return null;var o;this.props.adhesionRendered?(o=50,Object(S.moveAdCloseX)(!1)):o=0;var a={headline:Object(w.localize)("onetap_message_unlock"),subhead:Object(w.localize)("onetap_subhead_signin_alerts_deals")};Object(T.featureIsEnabled)("t10349_facebook_onetap_w_value_copy")&&(a={headline:Object(w.localize)("mg2019_fbot_see_where_friends_traveled"),subhead:Object(w.localize)("onetap_subhead_signin_alerts_deals")}),window.onFacebookOneTapLogin=this.onFacebookLogin,setTimeout(function(){window.FB.XFBML.parse()},50);var t=Object(T.featureIsEnabled)("facebook_limited_permissions")?"email":"email,user_hometown,user_friends,user_likes,user_location,user_status,user_photos";return _.createElement("div",{className:"MOBILE"===this.props.viewportCategory?F()("memx-facebook-onetap-FacebookOneTapLoader__fbOneTapMessageContainer--2-Az3","memx-facebook-onetap-FacebookOneTapLoader__fbOneTapMessageMobileDevice--1xICl"):F()("memx-facebook-onetap-FacebookOneTapLoader__fbOneTapMessageContainer--2-Az3","memx-facebook-onetap-FacebookOneTapLoader__fbOneTapMessageDesktopTablet--YpYwT"),style:{bottom:"".concat("MOBILE"===this.props.viewportCategory?"".concat(o,"px"):"unset")}},_.createElement(y.CloseX,{close:this.dismissFbOneTap}),_.createElement("div",{className:"memx-facebook-onetap-FacebookOneTapLoader__fbOneTapMessageInnerContainer--bb6RY"},_.createElement("div",{className:"memx-facebook-onetap-FacebookOneTapLoader__headline--3xXmn"},_.createElement("div",null,a.headline)),_.createElement("p",{className:"memx-facebook-onetap-FacebookOneTapLoader__subhead--1Ver3"},a.subhead),_.createElement("div",{className:"memx-facebook-onetap-FacebookOneTapLoader__loginButtonContainer--19Y0X"},_.createElement("div",{className:"memx-facebook-onetap-FacebookOneTapLoader__continueWithButton--3oNq1"},_.createElement("div",{className:"fb-login-button","data-width":"100%","data-max-rows":"1","data-size":"large","data-button-type":"continue_with","data-show-faces":"true","data-auto-logout-link":"false","data-use-continue-as":"true","data-scope":t,"data-onlogin":"window.onFacebookOneTapLogin();",style:{width:"100%"}}))),_.createElement("div",{className:"memx-facebook-onetap-FacebookOneTapLoader__disclaimer--1Y5vP"},Object(w.unescaped)(Object(w.localize)("terms_and_policy_links",{0:"/pages/terms.html",1:"/pages/privacy.html",2:"legalLink"})))))}}]),o}(_.Component);o.default=Object(h.connect)(function(e){return{fbApiVersion:e.auth.fbApi.apiVersion,fbConnectAppId:e.auth.fbApi.facebookConnectAppId,fbSdkUrl:e.auth.fbApi.sdkUrl,servlet:e.meta.initialServletName,cookieDomain:e.meta.cookieDomain,viewportCategory:e.meta.device.viewportCategory}},{setShouldFire:j.ACTIONS.setShouldFire})(N)}}});
//# sourceMappingURL=memx.facebook-onetap.bcd2400ba8.js.map